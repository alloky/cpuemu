- [README](README.md)
- [Описание ситемы команд ВМ](VM_Commands.md) 

# VBC Assembler

## Инструкции

Все инструкции в vbcasm пишутся на отдельных строках.

Структура инструкции: 

`(имя комады ВМ) (аргумент_1) (аргумент_2) ...` 

Имя команды совпадает с названием команд ВМ, описанных в [файле описания ВМ](VM_Commands.md),  написнными в нижнем регистре.

Аргументы отделяются пробелом. В конце строки пробелов быть не должно (будет пофикшено в следующих версиях). 

Также существуют препроцессорные дерективы, функции и метки, смотри ниже.

## Препроцессорные дерективы

Препроцессорные дерективы начинаются с сивола **.**

- **.stack_size** - задаёт максимальный размер стека. Дефолтный размер - 32 килобайта. Один аргумент - число.
- **.text** - записывает в .data именованную строку. Первым аргументом идёт имя строки, вторым аргуметом идёт строка в ковычках. Внутри строки кавычек быть не должно. Имя строки не должно содержать пробелов.

*Пример:*

		.stack_size 1024
		.text msg1 "my message"
## Метки

Метки задаются на отдельной строке. Сначала идёт *:*, затем имя метки - последовательность символов без пробелов.

При трансляции в vbc метки транслируется в адресс после предыдущей не метковой инстрункции относительно начала .code

Функции реализуются через метки.

*Пример:*

		:print1
		outc rbx
		ret
		
		movl r1 65
		movl rax 4
		:loop
		call :print1
		subl rax 1
		cmpl rax 0
		jle :end_label
		jmp :loop
		:end_label
		# выведет AAAA

## Аргументы инструкций

### Регистры

Регистров 16: 4 именновыанных и 12 цифровых. 

- Именнованные регистры: rax, rbx, rcx, rdx.

- Цифровые регистры. Нумерация идёт с нуля. Записывается как rN, где r - номер. 

- Указатель : можно передать команде регист не как целочисленное значение, а как значение, которое лежит по адресу, лежащему в этом регистре. для этого надо взять регистр в квадратные скобки.

*Пример:*

		movl r0 r2
		addl r0 rax
		movl rax [r0]
### Числа

Поддерживаются лишь неотрицательные числа, не превыщающие максимального чилса типа long long в окружении компиляции. 

*Пример:*

		movl rax 0
		subl rax 100
		addl rax 10
		out rax
		# выведет -90
### Метки

Если аргумент имеет тип метка, то он записывается как *:имя_метки*

*Пример:*

		:loop
		subl rax 1
		cmpl rax 0
		jle :end_label
		jmp :loop
### Строки

Можно положить как агрумент адресс начала строки из data, для этого надо написать *$* перед именем строки, см пример.



*Пример:*

		.text hw "Hello world"
		
		movl rax $hw
		andl rax 255
		outc rax
		# выведет H